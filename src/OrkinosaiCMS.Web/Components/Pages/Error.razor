@page "/Error"
@using System.Diagnostics
@inject IConfiguration Configuration

<PageTitle>Error - Mosaic CMS</PageTitle>

<div class="error-container">
    <div class="error-card">
        <div class="error-icon">⚠️</div>
        <h1>Service Temporarily Unavailable</h1>
        
        @if (IsDatabaseError)
        {
            <div class="error-message-primary">
                <p>We're experiencing connectivity issues with our database service.</p>
            </div>
            <div class="error-actions">
                <h3>What you can do:</h3>
                <ul>
                    <li>Wait a few moments and try again</li>
                    <li>Refresh this page</li>
                    <li>Contact support if the issue persists</li>
                </ul>
            </div>
        }
        else
        {
            <div class="error-message-primary">
                <p>An unexpected error occurred while processing your request.</p>
            </div>
            <div class="error-actions">
                <h3>What you can do:</h3>
                <ul>
                    <li>Go back and try again</li>
                    <li>Return to the <a href="/admin">admin dashboard</a></li>
                    <li>Contact support if the issue persists</li>
                </ul>
            </div>
        }

        @if (ShowRequestId)
        {
            <div class="request-info">
                <p><strong>Request ID:</strong> <code>@RequestId</code></p>
                <p class="request-note">Please include this ID when contacting support.</p>
            </div>
        }

        @if (ShowDetailedErrors)
        {
            <div class="detailed-error">
                <h3>Technical Details</h3>
                <p class="warning-note">
                    <strong>Note:</strong> Detailed error information is displayed because the application is in Development mode.
                    This should be disabled in production environments.
                </p>
            </div>
        }
    </div>
</div>

<style>
    .error-container {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 20px;
    }

    .error-card {
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        padding: 48px;
        max-width: 600px;
        width: 100%;
        text-align: center;
    }

    .error-icon {
        font-size: 64px;
        margin-bottom: 24px;
    }

    .error-card h1 {
        color: #1a202c;
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 16px;
    }

    .error-message-primary {
        margin-bottom: 32px;
    }

    .error-message-primary p {
        color: #4a5568;
        font-size: 18px;
        line-height: 1.6;
    }

    .error-actions {
        text-align: left;
        background: #f7fafc;
        border-radius: 8px;
        padding: 24px;
        margin-bottom: 24px;
    }

    .error-actions h3 {
        color: #2d3748;
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 12px;
    }

    .error-actions ul {
        margin: 0;
        padding-left: 24px;
        color: #4a5568;
    }

    .error-actions li {
        margin-bottom: 8px;
        line-height: 1.6;
    }

    .error-actions a {
        color: #667eea;
        text-decoration: none;
        font-weight: 500;
    }

    .error-actions a:hover {
        text-decoration: underline;
    }

    .request-info {
        background: #edf2f7;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 24px;
        text-align: left;
    }

    .request-info p {
        margin: 4px 0;
        color: #2d3748;
        font-size: 14px;
    }

    .request-info code {
        background: #e2e8f0;
        padding: 2px 8px;
        border-radius: 4px;
        font-family: 'Courier New', monospace;
        font-size: 13px;
    }

    .request-note {
        font-size: 12px !important;
        color: #718096 !important;
        margin-top: 8px !important;
    }

    .detailed-error {
        text-align: left;
        background: #fff5f5;
        border-left: 4px solid #fc8181;
        padding: 16px;
        border-radius: 4px;
    }

    .detailed-error h3 {
        color: #742a2a;
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 8px;
    }

    .warning-note {
        color: #742a2a;
        font-size: 13px;
        line-height: 1.5;
        margin: 0;
    }
</style>

@code {
    [CascadingParameter]
    private HttpContext? HttpContext { get; set; }

    private string? RequestId { get; set; }
    private bool ShowRequestId => !string.IsNullOrEmpty(RequestId);
    private bool IsDatabaseError { get; set; }
    private bool ShowDetailedErrors { get; set; }

    protected override void OnInitialized()
    {
        RequestId = Activity.Current?.Id ?? HttpContext?.TraceIdentifier;
        
        // Check if this is a database-related error
        if (HttpContext?.Items.ContainsKey("DatabaseError") == true)
        {
            IsDatabaseError = true;
        }
        
        // Check configuration for detailed errors
        ShowDetailedErrors = Configuration.GetValue<bool>("ErrorHandling:ShowDetailedErrors");
    }
}
